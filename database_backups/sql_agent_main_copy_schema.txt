CREATE TABLE users (
	id INTEGER NOT NULL, 
	email VARCHAR(255) NOT NULL, 
	phone VARCHAR(20), 
	hashed_password VARCHAR(255) NOT NULL, 
	first_name VARCHAR(100), 
	last_name VARCHAR(100), 
	is_active BOOLEAN, 
	is_verified BOOLEAN, 
	is_premium BOOLEAN, 
	avatar_url VARCHAR(500), 
	date_of_birth DATETIME, 
	gender VARCHAR(10), 
	address TEXT, 
	city VARCHAR(100), 
	state VARCHAR(100), 
	country VARCHAR(100), 
	postal_code VARCHAR(20), 
	notification_preferences TEXT, 
	theme_preference VARCHAR(20), 
	language VARCHAR(10), 
	annual_income FLOAT, 
	credit_score INTEGER, 
	spending_pattern TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP), 
	updated_at DATETIME, 
	last_login DATETIME, 
	PRIMARY KEY (id)
);
CREATE UNIQUE INDEX ix_users_phone ON users (phone);
CREATE INDEX ix_users_id ON users (id);
CREATE UNIQUE INDEX ix_users_email ON users (email);
CREATE TABLE merchants (
	id INTEGER NOT NULL, 
	name VARCHAR(200) NOT NULL, 
	display_name VARCHAR(200) NOT NULL, 
	description TEXT, 
	website VARCHAR(500), 
	logo_url VARCHAR(500), 
	primary_category VARCHAR(100) NOT NULL, 
	secondary_categories JSON, 
	mcc_code VARCHAR(10), 
	address TEXT, 
	city VARCHAR(100), 
	state VARCHAR(100), 
	country VARCHAR(100), 
	postal_code VARCHAR(20), 
	latitude FLOAT, 
	longitude FLOAT, 
	business_type VARCHAR(100), 
	is_chain BOOLEAN, 
	parent_company VARCHAR(200), 
	reward_multipliers JSON, 
	special_offers JSON, 
	cashback_offers JSON, 
	is_active BOOLEAN, 
	is_verified BOOLEAN, 
	is_featured BOOLEAN, 
	tags JSON, 
	merchant_metadata JSON, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP), 
	updated_at DATETIME, 
	PRIMARY KEY (id)
);
CREATE INDEX ix_merchants_primary_category ON merchants (primary_category);
CREATE INDEX ix_merchants_name ON merchants (name);
CREATE INDEX ix_merchants_id ON merchants (id);
CREATE TABLE card_master_data (
	id INTEGER NOT NULL, 
	bank_name VARCHAR(100) NOT NULL, 
	card_name VARCHAR(200) NOT NULL, 
	card_variant VARCHAR(100), 
	card_network VARCHAR(50) NOT NULL, 
	card_tier VARCHAR(13) NOT NULL, 
	joining_fee FLOAT, 
	annual_fee FLOAT, 
	is_lifetime_free BOOLEAN, 
	annual_fee_waiver_spend FLOAT, 
	foreign_transaction_fee FLOAT, 
	late_payment_fee FLOAT, 
	overlimit_fee FLOAT, 
	cash_advance_fee FLOAT, 
	domestic_lounge_visits INTEGER, 
	international_lounge_visits INTEGER, 
	lounge_spend_requirement FLOAT, 
	lounge_spend_period VARCHAR(20), 
	welcome_bonus_points FLOAT, 
	welcome_bonus_spend_requirement FLOAT, 
	welcome_bonus_timeframe INTEGER, 
	minimum_credit_limit FLOAT, 
	maximum_credit_limit FLOAT, 
	minimum_salary FLOAT, 
	minimum_age INTEGER, 
	maximum_age INTEGER, 
	contactless_enabled BOOLEAN, 
	chip_enabled BOOLEAN, 
	mobile_wallet_support JSON, 
	insurance_benefits JSON, 
	concierge_service BOOLEAN, 
	milestone_benefits JSON, 
	reward_program_name VARCHAR(100), 
	reward_expiry_period INTEGER, 
	reward_conversion_rate FLOAT, 
	minimum_redemption_points FLOAT, 
	is_active BOOLEAN, 
	is_available_online BOOLEAN, 
	launch_date DATETIME, 
	discontinue_date DATETIME, 
	description TEXT, 
	terms_and_conditions_url VARCHAR(500), 
	application_url VARCHAR(500), 
	additional_features JSON, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP), 
	updated_at DATETIME, 
	PRIMARY KEY (id)
);
CREATE INDEX ix_card_master_data_id ON card_master_data (id);
CREATE INDEX ix_card_master_data_bank_name ON card_master_data (bank_name);
CREATE TABLE credit_cards (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	card_master_data_id INTEGER, 
	card_name VARCHAR(200) NOT NULL, 
	card_type VARCHAR(50) NOT NULL, 
	card_network VARCHAR(50) NOT NULL, 
	card_number_last4 VARCHAR(4) NOT NULL, 
	card_holder_name VARCHAR(200) NOT NULL, 
	expiry_month INTEGER NOT NULL, 
	expiry_year INTEGER NOT NULL, 
	credit_limit FLOAT, 
	available_credit FLOAT, 
	current_balance FLOAT, 
	due_date DATETIME, 
	minimum_payment FLOAT, 
	reward_rate_general FLOAT, 
	reward_rate_dining FLOAT, 
	reward_rate_groceries FLOAT, 
	reward_rate_travel FLOAT, 
	reward_rate_online_shopping FLOAT, 
	reward_rate_fuel FLOAT, 
	reward_rate_entertainment FLOAT, 
	welcome_benefits TEXT, 
	annual_fee FLOAT, 
	foreign_transaction_fee FLOAT, 
	late_payment_fee FLOAT, 
	is_active BOOLEAN, 
	is_default BOOLEAN, 
	is_primary BOOLEAN, 
	features JSON, 
	notes TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP), 
	updated_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(card_master_data_id) REFERENCES card_master_data (id)
);
CREATE INDEX ix_credit_cards_id ON credit_cards (id);
CREATE TABLE conversations (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	title VARCHAR(200), 
	conversation_type VARCHAR(50), 
	status VARCHAR(20), 
	user_preferences JSON, 
	conversation_context JSON, 
	message_count INTEGER, 
	total_tokens_used INTEGER, 
	ai_response_time_avg FLOAT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP), 
	updated_at DATETIME, 
	last_message_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
);
CREATE INDEX ix_conversations_id ON conversations (id);
CREATE TABLE card_spending_categories (
	id INTEGER NOT NULL, 
	card_master_id INTEGER NOT NULL, 
	category_name VARCHAR(100) NOT NULL, 
	category_display_name VARCHAR(100) NOT NULL, 
	reward_rate FLOAT NOT NULL, 
	reward_type VARCHAR(50), 
	reward_cap FLOAT, 
	reward_cap_period VARCHAR(20), 
	minimum_transaction_amount FLOAT, 
	is_active BOOLEAN, 
	valid_from DATETIME, 
	valid_until DATETIME, 
	additional_conditions TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP), 
	updated_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(card_master_id) REFERENCES card_master_data (id)
);
CREATE INDEX ix_card_spending_categories_id ON card_spending_categories (id);
CREATE TABLE card_merchant_rewards (
	id INTEGER NOT NULL, 
	card_master_id INTEGER NOT NULL, 
	merchant_name VARCHAR(100) NOT NULL, 
	merchant_display_name VARCHAR(100) NOT NULL, 
	merchant_category VARCHAR(100), 
	reward_rate FLOAT NOT NULL, 
	reward_type VARCHAR(50), 
	reward_cap FLOAT, 
	reward_cap_period VARCHAR(20), 
	minimum_transaction_amount FLOAT, 
	is_active BOOLEAN, 
	valid_from DATETIME, 
	valid_until DATETIME, 
	requires_registration BOOLEAN, 
	additional_conditions TEXT, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP), 
	updated_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(card_master_id) REFERENCES card_master_data (id)
);
CREATE INDEX ix_card_merchant_rewards_id ON card_merchant_rewards (id);
CREATE TABLE transactions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	credit_card_id INTEGER NOT NULL, 
	merchant_id INTEGER, 
	transaction_id VARCHAR(100) NOT NULL, 
	amount FLOAT NOT NULL, 
	currency VARCHAR(3), 
	transaction_date DATETIME NOT NULL, 
	posted_date DATETIME, 
	description TEXT NOT NULL, 
	category VARCHAR(100), 
	subcategory VARCHAR(100), 
	transaction_type VARCHAR(50) NOT NULL, 
	merchant_name VARCHAR(200), 
	merchant_category VARCHAR(100), 
	merchant_city VARCHAR(100), 
	merchant_state VARCHAR(100), 
	merchant_country VARCHAR(100), 
	payment_method VARCHAR(50), 
	is_online BOOLEAN, 
	is_foreign BOOLEAN, 
	reward_rate_applied FLOAT, 
	reward_amount FLOAT, 
	reward_points INTEGER, 
	reward_category VARCHAR(100), 
	status VARCHAR(50), 
	is_disputed BOOLEAN, 
	is_recurring BOOLEAN, 
	reference_number VARCHAR(100), 
	notes TEXT, 
	transaction_metadata JSON, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP), 
	updated_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(credit_card_id) REFERENCES credit_cards (id), 
	FOREIGN KEY(merchant_id) REFERENCES merchants (id)
);
CREATE INDEX ix_transactions_id ON transactions (id);
CREATE UNIQUE INDEX ix_transactions_transaction_id ON transactions (transaction_id);
CREATE INDEX ix_transactions_category ON transactions (category);
CREATE TABLE conversation_messages (
	id INTEGER NOT NULL, 
	conversation_id INTEGER NOT NULL, 
	role VARCHAR(20) NOT NULL, 
	content TEXT NOT NULL, 
	message_type VARCHAR(50), 
	tokens_used INTEGER, 
	model_used VARCHAR(100), 
	response_time FLOAT, 
	message_metadata JSON, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP), 
	PRIMARY KEY (id), 
	FOREIGN KEY(conversation_id) REFERENCES conversations (id)
);
CREATE INDEX ix_conversation_messages_id ON conversation_messages (id);
CREATE TABLE card_recommendations (
	id INTEGER NOT NULL, 
	conversation_id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	card_name VARCHAR(200) NOT NULL, 
	card_type VARCHAR(50) NOT NULL, 
	card_network VARCHAR(50) NOT NULL, 
	recommendation_reason TEXT NOT NULL, 
	expected_rewards FLOAT, 
	annual_fee FLOAT, 
	credit_score_requirement INTEGER, 
	spending_categories JSON, 
	category_reward_rates JSON, 
	status VARCHAR(20), 
	user_feedback VARCHAR(20), 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP), 
	updated_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(conversation_id) REFERENCES conversations (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
);
CREATE INDEX ix_card_recommendations_id ON card_recommendations (id);
CREATE TABLE rewards (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	credit_card_id INTEGER, 
	transaction_id INTEGER, 
	reward_type VARCHAR(50) NOT NULL, 
	reward_category VARCHAR(100), 
	amount FLOAT NOT NULL, 
	points INTEGER, 
	currency VARCHAR(3), 
	description TEXT NOT NULL, 
	source VARCHAR(100) NOT NULL, 
	reward_rate FLOAT, 
	multiplier FLOAT, 
	status VARCHAR(50), 
	is_credited BOOLEAN, 
	credited_date DATETIME, 
	expiry_date DATETIME, 
	redemption_amount FLOAT, 
	redemption_date DATETIME, 
	redemption_method VARCHAR(100), 
	notes TEXT, 
	reward_metadata JSON, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP), 
	updated_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(credit_card_id) REFERENCES credit_cards (id), 
	FOREIGN KEY(transaction_id) REFERENCES transactions (id)
);
CREATE INDEX ix_rewards_id ON rewards (id);
CREATE TABLE alembic_version (
	version_num VARCHAR(32) NOT NULL, 
	CONSTRAINT alembic_version_pkc PRIMARY KEY (version_num)
);
CREATE TABLE card_reviews (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	card_master_id INTEGER NOT NULL, 
	overall_rating INTEGER NOT NULL, 
	review_title VARCHAR(200), 
	review_content TEXT, 
	pros TEXT, 
	cons TEXT, 
	experience TEXT, 
	is_verified_cardholder BOOLEAN, 
	helpful_votes INTEGER, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP), 
	updated_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(card_master_id) REFERENCES card_master_data (id)
);
CREATE INDEX ix_card_reviews_id ON card_reviews (id);
CREATE TABLE review_votes (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	review_id INTEGER NOT NULL, 
	vote_type VARCHAR(20) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(review_id) REFERENCES card_reviews (id)
);
CREATE INDEX ix_review_votes_id ON review_votes (id);
CREATE TABLE community_posts (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	card_master_id INTEGER NOT NULL, 
	title VARCHAR(300) NOT NULL, 
	body TEXT, 
	upvotes INTEGER, 
	downvotes INTEGER, 
	comment_count INTEGER, 
	is_deleted BOOLEAN, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP), 
	updated_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(card_master_id) REFERENCES card_master_data (id)
);
CREATE INDEX ix_community_posts_id ON community_posts (id);
CREATE TABLE community_comments (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	post_id INTEGER NOT NULL, 
	parent_id INTEGER, 
	body TEXT NOT NULL, 
	upvotes INTEGER, 
	downvotes INTEGER, 
	is_deleted BOOLEAN, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP), 
	updated_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(post_id) REFERENCES community_posts (id), 
	FOREIGN KEY(parent_id) REFERENCES community_comments (id)
);
CREATE INDEX ix_community_comments_id ON community_comments (id);
CREATE TABLE post_votes (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	post_id INTEGER NOT NULL, 
	vote_type VARCHAR(20) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(post_id) REFERENCES community_posts (id)
);
CREATE INDEX ix_post_votes_id ON post_votes (id);
CREATE TABLE comment_votes (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	comment_id INTEGER NOT NULL, 
	vote_type VARCHAR(20) NOT NULL, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(comment_id) REFERENCES community_comments (id)
);
CREATE INDEX ix_comment_votes_id ON comment_votes (id);
CREATE TABLE user_roles (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	role_type VARCHAR(50) NOT NULL, 
	approved_by INTEGER, 
	approved_at DATETIME, 
	status VARCHAR(20), 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP), 
	updated_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(approved_by) REFERENCES users (id)
);
CREATE INDEX ix_user_roles_id ON user_roles (id);
CREATE TABLE moderator_requests (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	request_reason TEXT, 
	user_activity_summary TEXT, 
	status VARCHAR(20), 
	reviewed_by INTEGER, 
	reviewed_at DATETIME, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP), 
	updated_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(reviewed_by) REFERENCES users (id)
);
CREATE INDEX ix_moderator_requests_id ON moderator_requests (id);
CREATE TABLE edit_suggestions (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	moderator_id INTEGER, 
	card_master_id INTEGER NOT NULL, 
	field_type VARCHAR(50) NOT NULL, 
	field_name VARCHAR(100) NOT NULL, 
	old_value TEXT, 
	new_value TEXT NOT NULL, 
	status VARCHAR(20), 
	reviewed_by INTEGER, 
	reviewed_at DATETIME, 
	review_notes TEXT, 
	suggestion_reason TEXT, 
	additional_data JSON, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP), 
	updated_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(moderator_id) REFERENCES users (id), 
	FOREIGN KEY(card_master_id) REFERENCES card_master_data (id), 
	FOREIGN KEY(reviewed_by) REFERENCES users (id)
);
CREATE INDEX ix_edit_suggestions_id ON edit_suggestions (id);
CREATE TABLE audit_logs (
	id INTEGER NOT NULL, 
	user_id INTEGER, 
	action_type VARCHAR(50) NOT NULL, 
	table_name VARCHAR(50) NOT NULL, 
	record_id INTEGER, 
	old_values JSON, 
	new_values JSON, 
	change_summary TEXT, 
	ip_address VARCHAR(45), 
	user_agent TEXT, 
	session_id VARCHAR(100), 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP), 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
);
CREATE INDEX ix_audit_logs_id ON audit_logs (id);
CREATE TABLE card_documents (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	card_master_id INTEGER NOT NULL, 
	title VARCHAR(200) NOT NULL, 
	description TEXT, 
	document_type VARCHAR(50) NOT NULL, 
	content TEXT NOT NULL, 
	file_name VARCHAR(255), 
	file_size INTEGER, 
	file_type VARCHAR(100), 
	status VARCHAR(20), 
	reviewed_by INTEGER, 
	reviewed_at DATETIME, 
	review_notes TEXT, 
	submission_reason TEXT, 
	additional_data JSON, 
	created_at DATETIME DEFAULT (CURRENT_TIMESTAMP), 
	updated_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(card_master_id) REFERENCES card_master_data (id), 
	FOREIGN KEY(reviewed_by) REFERENCES users (id)
);
CREATE INDEX ix_card_documents_id ON card_documents (id);
